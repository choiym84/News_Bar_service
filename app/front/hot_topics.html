<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>í•«í† í”½ ë¶„ì„</title>
    <style>
        .tag, .stance-button, .media-button {
            display: inline-block;
            margin: 5px;
            padding: 6px 12px;
            background: #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
        }

        .hidden { display: none; }
        .highlight { background: #d0ebff; }

        .summary-fixed-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 15px;
            background: #fefefe;
            min-height: 80px;
        }

        .analysis-box {
            margin-top: 20px;
            padding: 10px;
            background: #f3f3f3;
            border-left: 4px solid #aaa;
            white-space: pre-line;
        }
    </style>
</head>
<body>
    <h2>ğŸ”¥ ì‹¤ì‹œê°„ ì¸ê¸° í‚¤ì›Œë“œ</h2>

    <!-- í‚¤ì›Œë“œ íƒ­ -->
    {% for topic in topics %}
        <span class="tag" onclick="showStances('{{ topic.id }}')">#{{ topic.name }}</span>
    {% endfor %}

    <hr>

    {% for topic in topics %}
    <div id="stance_area_{{ topic.id }}" class="hidden">
        <h3>#{{ topic.name }}</h3>

        {% for stance in ['ì§„ë³´', 'ì¤‘ë¦½', 'ë³´ìˆ˜'] %}
            <span class="stance-button" onclick="showMedia('{{ topic.id }}', '{{ stance }}')">{{ stance }}</span>
        {% endfor %}

        {% for stance in ['ì§„ë³´', 'ì¤‘ë¦½', 'ë³´ìˆ˜'] %}
        <div id="media_area_{{ topic.id }}_{{ stance }}" class="hidden">
            <h4>ğŸ§­ {{ stance }}</h4>

            <!-- ì–¸ë¡ ì‚¬ ë²„íŠ¼ -->
            {% for item in topic.groups[stance] %}
                <span class="media-button"
                      onclick="showSummaryInBox('{{ topic.id }}', '{{ stance }}', `{{ item.summary|escape }}`, '{{ item.publisher }}')">
                    {{ item.publisher }}
                </span>
            {% endfor %}

            {% if not topic.groups[stance] %}
                <div>ë°ì´í„° ì—†ìŒ</div>
            {% endif %}

            <!-- ìš”ì•½ ë°•ìŠ¤ (ê³ ì • ìœ„ì¹˜) -->
            <div id="summary_box_{{ topic.id }}_{{ stance }}" class="summary-fixed-box"></div>
        </div>
        {% endfor %}

        <!-- ë¶„ì„ ê²°ê³¼ í‘œì‹œ -->
        {% if topic.analysis %}
        <div class="analysis-box">
            <h4>ğŸ“Š GPT ë¶„ì„ ìš”ì•½</h4>
            {% for category, values in topic.analysis.items() %}
                <div>
                    <strong>[{{ category }}]</strong><br>
                    - ì§„ë³´: {{ values["ì§„ë³´"] }}<br>
                    - ì¤‘ë¦½: {{ values["ì¤‘ë¦½"] }}<br>
                    - ë³´ìˆ˜: {{ values["ë³´ìˆ˜"] }}<br><br>
                </div>
            {% endfor %}
        </div>
        {% endif %}

    </div>
    {% endfor %}

    <script>
        function hideAll(prefix) {
            document.querySelectorAll(`[id^='${prefix}_']`).forEach(el => el.classList.add("hidden"));
        }

        function showStances(topicId) {
            hideAll("stance_area");
            hideAll("media_area");
            document.querySelectorAll(".summary-fixed-box").forEach(e => e.innerHTML = "");
            const el = document.getElementById(`stance_area_${topicId}`);
            if (el) el.classList.remove("hidden");
        }

        function showMedia(topicId, stance) {
            hideAll("media_area");
            document.querySelectorAll(".summary-fixed-box").forEach(e => e.innerHTML = "");
            const el = document.getElementById(`media_area_${topicId}_${stance}`);
            if (el) el.classList.remove("hidden");
        }

        function showSummaryInBox(topicId, stance, summary, publisher) {
            const box = document.getElementById(`summary_box_${topicId}_${stance}`);
            if (box) {
                box.innerHTML = `<strong>${publisher}</strong><br>${summary}`;
            }
        }
    </script>
</body>
</html>
